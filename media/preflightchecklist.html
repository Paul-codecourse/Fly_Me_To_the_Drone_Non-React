<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Drone Preflight Checklist</title>
  
  <!-- Include Google GSI script for OAuth sign-in -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <style>
    body {
      background-color: #f4f4f9;
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    .container {
      text-align: center;
      margin-top: 50px;
    }

    .btn-google {
      background-color: #4285F4;
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
    }

    .btn-google:hover {
      background-color: #357ae8;
    }

    .welcome-message {
      margin-top: 20px;
      font-size: 1.5rem;
      font-weight: bold;
    }

    .checklist {
      margin-top: 30px;
      text-align: left;
      font-size: 1.2rem;
    }

    .checklist-item {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }

    .checklist-item input {
      margin-right: 10px;
    }

    .checklist-item label {
      font-size: 1.2rem;
    }

    .checklist-header {
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .search-box {
      margin-top: 20px;
    }

    .search-box input {
      padding: 10px;
      width: 200px;
      margin-right: 10px;
      border-radius: 5px;
    }

    .search-box button {
      padding: 10px 20px;
      background-color: #4facfe;
      color: white;
      border-radius: 5px;
      cursor: pointer;
    }

  </style>
</head>
<body>

<div class="container">
  <h1>Drone Preflight Checklist</h1>

  <!-- Google Sign-In Button -->
  <div id="google-signin-button"></div>
  
  <!-- Welcome Message -->
  <div id="welcome-message" class="welcome-message" style="display: none;"></div>

  <!-- Preflight Checklist -->
  <div id="checklist" class="checklist" style="display: none;">
    <div class="checklist-header">Preflight Checklist</div>

    <!-- Checklist Items -->
    <div class="checklist-item">
      <input type="checkbox" id="battery" />
      <label for="battery">Check battery level (at least 50%)</label>
    </div>
    <div class="checklist-item">
      <input type="checkbox" id="propellers" />
      <label for="propellers">Inspect propellers for damage</label>
    </div>
    <div class="checklist-item">
      <input type="checkbox" id="gps" />
      <label for="gps">Ensure GPS is functioning</label>
    </div>
    <div class="checklist-item">
      <input type="checkbox" id="weather" />
      <label for="weather">Check weather conditions (wind, rain)</label>
    </div>
    <div class="checklist-item">
      <input type="checkbox" id="signal" />
      <label for="signal">Verify remote control signal strength</label>
    </div>
    <div class="checklist-item">
      <input type="checkbox" id="area" />
      <label for="area">Verify no-fly zones and obstacles in the area</label>
    </div>
    <div class="checklist-item">
      <input type="checkbox" id="takeoff" />
      <label for="takeoff">Ensure takeoff area is clear of obstructions</label>
    </div>
    
    <!-- Start Flight Section -->
    <button id="start-flight" class="btn-google" style="margin-top: 20px;">Start Flight</button>
  </div>

  <!-- Search Box Section (Optional) -->
  <div class="search-box" style="display: none;">
    <input type="text" id="search-input" placeholder="Search previous flights...">
    <button onclick="searchData()">Search</button>
    <p id="search-result"></p>
  </div>
</div>

<script>
  // Array with sample data of previous flights (for search functionality)
  const previousFlights = [
    { date: '2024-11-01', location: 'Park A', flightTime: '30 min' },
    { date: '2024-10-28', location: 'Beach B', flightTime: '45 min' },
    { date: '2024-10-15', location: 'Field C', flightTime: '60 min' },
  ];

  let userName = '';
  let userEmail = '';

  // Google Sign-In callback function
  function onSignIn(googleUser) {
    const profile = googleUser.getBasicProfile();
    console.log("User signed in: " + profile.getName());

    // Store the user data in variables
    userName = profile.getName();
    userEmail = profile.getEmail();

    // Display the welcome message with the user's name
    document.getElementById('welcome-message').style.display = 'block';
    document.getElementById('welcome-message').innerText = 'Welcome, ' + userName + '!';

    // Display the checklist after sign-in
    document.getElementById('checklist').style.display = 'block';
  }

  // Google Sign-In initialization
  function startApp() {
    gapi.load('auth2', function() {
      gapi.auth2.init({
        client_id: 'YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com', // Replace with your Google Client ID
      }).then(function() {
        console.log("Google API loaded successfully.");
        gapi.signin2.render('google-signin-button', {
          'scope': 'profile email',
          'longtitle': true,
          'theme': 'dark',
          'onsuccess': onSignIn
        });
      });
    });
  }

  // Function to search previous flight data
  function searchData() {
    const searchTerm = document.getElementById('search-input').value.toLowerCase();
    const result = previousFlights.filter(item => 
      item.location.toLowerCase().includes(searchTerm) || 
      item.date.toLowerCase().includes(searchTerm)
    );

    if (result.length > 0) {
      document.getElementById('search-result').innerText = `Found ${result.length} flight(s):`;
      result.forEach(item => {
        document.getElementById('search-result').innerText += `\nDate: ${item.date}, Location: ${item.location}, Flight Time: ${item.flightTime}`;
      });
    } else {
      document.getElementById('search-result').innerText = 'No results found.';
    }
  }

  // Start the flight once all checklist items are ticked
  document.getElementById('start-flight').addEventListener('click', () => {
    const checkboxes = document.querySelectorAll('.checklist-item input');
    const allChecked = Array.from(checkboxes).every(checkbox => checkbox.checked);

    if (allChecked) {
      alert("All items checked. You can now start the flight!");
      // You can redirect to another page or start the flight logic here
    } else {
      alert("Please complete all items on the checklist before starting the flight.");
    }
  });

  window.onload = startApp;
</script>

</body>
</html>
